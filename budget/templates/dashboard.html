{% extends 'base.html' %}

{% block content %}
<style>
    .dash-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* Cards Grid */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #ccc; }
    .card.bal { border-color: #3b82f6; }
    .card.inc { border-color: #10b981; }
    .card.exp { border-color: #ef4444; }
    .card h3 { font-size: 0.9rem; color: #666; text-transform: uppercase; margin: 0;}
    .card p { font-size: 1.8rem; font-weight: bold; margin-top: 5px; color: #333; }

    /* Recent Table */
    .recent-box { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .box-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
    table { width: 100%; border-collapse: collapse; }
    td, th { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .text-green { color: #10b981; font-weight: bold; }
    .text-red { color: #ef4444; font-weight: bold; }
    
    /* FIX: This button now points to 'finance_manager' correctly */
    .link-btn { color: #3b82f6; text-decoration: none; font-weight: bold; }
</style>

<div class="dash-container">
    <h2>Dashboard</h2>
    
    <div class="stats-grid">
        <div class="card bal">
            <h3>Current Balance</h3>
            <p>KES {{ balance }}</p>
        </div>
        <div class="card inc">
            <h3>Total Income</h3>
            <p class="text-green">+ KES {{ income }}</p>
        </div>
        <div class="card exp">
            <h3>Total Expenses</h3>
            <p class="text-red">- KES {{ expense }}</p>
        </div>
    </div>

    <div class="recent-box">
        <div class="box-header">
            <h3>Recent Activity</h3>
            <a href="{% url 'finance_manager' %}" class="link-btn">View All Transactions &rarr;</a>
        </div>
        <table>
            <tbody>
                {% for t in recent_transactions %}
                <tr>
                    <td>
                        <strong>{{ t.description }}</strong><br>
                        <small style="color:#888">{{ t.date }}</small>
                    </td>
                    <td class="{% if t.category.type == 'income' %}text-green{% else %}text-red{% endif %}">
                        {{ t.amount }}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="2">No recent activity.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}